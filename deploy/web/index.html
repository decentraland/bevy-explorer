<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        // Set base href so relative paths work when deployed under a subpath (e.g. /bevy-web)
        (function() {
            var base = document.createElement('base');
            var path = window.location.pathname;
            base.href = path.endsWith('/') ? path : path + '/';
            document.head.appendChild(base);
        })();
    </script>
    <script>
    (function () {
        function isMobile() {
            return /Android|iPhone|iPad|iPod|webOS|BlackBerry|Opera Mini|IEMobile|Windows Phone/i.test(navigator.userAgent);
        }

        function isLikelyGoogleChromeDesktop() {
            var ua = navigator.userAgent;
            if (!/Chrome\//.test(ua)) return false;
            if (/Edg\//.test(ua)) return false;
            if (/OPR\//.test(ua)) return false;
            if (/Brave/.test(ua)) return false;
            if (/SamsungBrowser\//.test(ua)) return false;
            if (/YaBrowser\//.test(ua)) return false;
            if (/Vivaldi\//.test(ua)) return false;
            if (navigator.brave && typeof navigator.brave.isBrave === 'function') return false;
            return true;
        }

        function renderGatePage(html) {
            document.addEventListener('DOMContentLoaded', function () {
                document.body.innerHTML = '';
                document.body.style.display = 'flex';
                document.body.style.alignItems = 'center';
                document.body.style.justifyContent = 'center';
                document.body.style.minHeight = '100vh';
                document.body.style.margin = '0';
                document.body.style.fontFamily = "'Inter', sans-serif";
                document.body.style.color = '#fff';

                var wrapper = document.createElement('div');
                wrapper.style.textAlign = 'center';
                wrapper.style.padding = '2rem';
                wrapper.style.maxWidth = '490px';
                wrapper.style.zIndex = '1';
                wrapper.innerHTML = html;
                document.body.appendChild(wrapper);
            });
        }

        if (isMobile()) {
            window.__browserGateBlocked = true;
            var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            var isAndroid = /android/i.test(navigator.userAgent);

            var appleBtn =
                  '<a href="https://testflight.apple.com/join/KF4r3jlU" class="store-btn apple">' +
                    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"></path></svg>' +
                    'Install from App Store' +
                  '</a>';
            var googleBtn =
                  '<a href="https://play.google.com/store/apps/details?id=org.decentraland.godotexplorer" class="store-btn google">' +
                    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3,20.5V3.5C3,2.91 3.34,2.39 3.84,2.15L13.69,12L3.84,21.85C3.34,21.6 3,21.09 3,20.5M16.81,15.12L6.05,21.34L14.54,12.85L16.81,15.12M20.16,10.81C20.5,11.08 20.75,11.5 20.75,12C20.75,12.5 20.53,12.9 20.18,13.18L17.89,14.5L15.39,12L17.89,9.5L20.16,10.81M6.05,2.66L16.81,8.88L14.54,11.15L6.05,2.66Z"></path></svg>' +
                    'Install from Google Play' +
                  '</a>';

            var buttons;
            if (isIOS) {
                buttons = appleBtn;
            } else if (isAndroid) {
                buttons = googleBtn;
            } else {
                buttons = appleBtn + googleBtn;
            }

            renderGatePage(
                '<h1 style="font-size:1.8rem;margin-bottom:1rem;">Decentraland BEVY</h1>' +
                '<p style="margin-bottom:2rem;color:rgba(255,255,255,0.7);">This experience is not available on mobile browsers. Download the app instead:</p>' +
                '<div class="store-buttons">' + buttons + '</div>'
            );
        } else if (!isLikelyGoogleChromeDesktop()) {
            window.__browserGateBlocked = true;
            renderGatePage(
                '<h1 style="font-size:1.8rem;margin-bottom:1rem;">Browser Not Supported</h1>' +
                '<p style="margin-bottom:2rem;color:rgba(255,255,255,0.7);">Decentraland BEVY requires <strong>Google Chrome</strong> on desktop to run.</p>' +
                '<div class="store-buttons">' +
                  '<a href="https://www.google.com/chrome/" class="store-btn">' +
                    '<svg viewBox="0 0 48 48" fill="none"><defs><linearGradient id="cg-a" x1="3.2173" y1="15" x2="44.7812" y2="15" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#d93025"/><stop offset="1" stop-color="#ea4335"/></linearGradient><linearGradient id="cg-b" x1="20.7219" y1="47.6791" x2="41.5039" y2="11.6837" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fcc934"/><stop offset="1" stop-color="#fbbc04"/></linearGradient><linearGradient id="cg-c" x1="26.5981" y1="46.5015" x2="5.8161" y2="10.506" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#1e8e3e"/><stop offset="1" stop-color="#34a853"/></linearGradient></defs><circle cx="24" cy="23.9947" r="12" fill="#fff"/><path d="M24,12H44.7812a23.9939,23.9939,0,0,0-41.5639.0029L13.6079,30l.0093-.0024A11.9852,11.9852,0,0,1,24,12Z" fill="url(#cg-a)"/><circle cx="24" cy="24" r="9.5" fill="#1a73e8"/><path d="M34.3913,30.0029,24.0007,48A23.994,23.994,0,0,0,44.78,12.0031H23.9989l-.0025.0093A11.985,11.985,0,0,1,34.3913,30.0029Z" fill="url(#cg-b)"/><path d="M13.6086,30.0031,3.218,12.006A23.994,23.994,0,0,0,24.0025,48L34.3931,30.0029l-.0067-.0068a11.9852,11.9852,0,0,1-20.7778.007Z" fill="url(#cg-c)"/></svg>' +
                    'Download Chrome' +
                  '</a>' +
                '</div>'
            );
        }
    })();
    </script>
    <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
    <link rel="shortcut icon" href="favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Decentraland (BEVY)" />
    <link rel="manifest" href="favicon/site.webmanifest" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decentraland (BEVY)</title>
    <style>

        video {
            display: none;
        }
        body {
            font-family: 'Inter', sans-serif; /* Changed to Inter */
            margin: 0px;
            color: #2d3748; /* Darker gray for text */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content */
            background: #18141a;

        }
        body:before {
            background: radial-gradient(
                    circle,
                    #A42CC4 0%,
                    #6e1f93 60%,
                    #511B7C 100%
            );
            content: "";
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .container {

            padding: 25px;
            margin-top: 100px;
            border-radius: 8px;
            width: 100%;
            max-width: 700px; /* Max width for content */
            z-index: 1;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        .title {
            color: white; /* Tailwind blue-700 */

            font-size: 3rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        h1 span {
            font-weight: 600;
        }
        label {
            display: block;
            color: #ffffff; /* Tailwind gray-700 */
            /*text-transform: uppercase;*/
            margin: 1rem 0 1rem 0;
            font-size: 1.2rem;
        }
        input[type="text"] {
            width: calc(100% - 22px); /* Full width minus padding and border */
            padding: 10px;
            border: 1px solid #cbd5e0; /* Tailwind gray-400 */
            border-radius: 6px;
            font-size: 1rem;
            color: #2d3748;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #4299e1; /* Tailwind blue-500 */
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }
        button {
            padding: 12px 20px;
            background-color: #FF2D55;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 25px;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            transition: background-color 0.2s ease-in-out;
            display: block;
            width: 36%;
            margin-left: auto;
            margin-right: auto;
        }
        button:hover {
            background-color: #e0264b;
        }
        #canvas-parent {
            z-index:1;
            display: none;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        #mygame-canvas {
            width: 100%;
            height: 100%;
            display: block; /* Remove extra space below canvas */
        }
        /* Added for better structure and responsiveness */
        .input-group {
            margin-bottom: 15px;
        }
        /* Form hidden by default, shown via JS when manualParams is present */
        form {
            display: none;
        }
        /* Button hidden while loading, shown via JS when ready */
        #initButton {
            display: none;
        }
        input[type=checkbox] {
            width: 1.2rem;
            height: 1.2rem;
            top:0.2rem;
            position: relative;
        }

        /* Loading UI */
        #loading-container {
            margin-top: 2rem;
            width: 100%;
        }
        .loading-overall {
            margin-bottom: 1.5rem;
        }
        .loading-overall-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .loading-overall-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF2D55, #FFBC5B);
            width: 0%;
            transition: width 0.3s ease;
        }
        .loading-steps {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .loading-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            transition: color 0.2s;
        }
        .loading-step.active {
            color: rgba(255, 255, 255, 0.9);
        }
        .loading-step.completed {
            color: rgba(255, 255, 255, 0.7);
        }
        .loading-step-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .loading-step-icon svg {
            width: 16px;
            height: 16px;
        }
        .loading-step-check {
            display: none;
        }
        .loading-step.completed .loading-step-check {
            display: block;
            color: #4ade80;
        }
        .loading-step.completed .loading-step-spinner {
            display: none;
        }
        .loading-step:not(.active):not(.completed) .loading-step-spinner {
            display: none;
        }
        .loading-step-content {
            flex: 1;
            min-width: 0;
        }
        .loading-step-name {
            display: block;
        }
        .loading-step-bar {
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 4px;
            overflow: hidden;
        }
        .loading-step-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.5);
            width: 0%;
            transition: width 0.2s ease;
        }
        .loading-step.completed .loading-step-fill {
            width: 100%;
            background: #4ade80;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-step-spinner {
            animation: spin 1s linear infinite;
            color: rgba(255, 255, 255, 0.7);
        }

        #loading-logo {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            align-items: center;
            justify-content: center;
        }
        #loading-logo img {
            width: calc(var(--vh, 1vh) * 10);
            height: calc(var(--vh, 1vh) * 10);
        }

        /* Store buttons */
        .store-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        .store-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: background 0.2s ease;
        }
        .store-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .store-btn svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        /* For smaller screens */
        @media (max-width: 600px) {
            body {
                margin: 10px;
            }
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 1.8rem;
            }
            button {
                width: 100%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div id="header" class="container">

    <h1 class="title"> <svg focusable="false" aria-hidden="true" viewBox="0 0 90 90" width="90" height="90" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M45 89.9999C69.8528 89.9999 89.9999 69.8528 89.9999 45C89.9999 20.1472 69.8528 0 45 0C20.1472 0 0 20.1472 0 45C0 69.8528 20.1472 89.9999 45 89.9999Z" fill="url(#paint0_linear_1_49380)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18 80.9996C25.515 86.6471 34.875 89.9996 45 89.9996C55.125 89.9996 64.485 86.6471 72 80.9996H18Z" fill="#FF2D55"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.00008 71.9996C11.5651 75.3971 14.6026 78.4346 18.0001 80.9996H72C75.3975 78.4346 78.435 75.3971 81 71.9996H9.00008Z" fill="#FFA25A"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M60.3675 62.9997H3.75757C5.15257 66.2172 6.93007 69.2322 9.00006 71.9997H60.39V62.9997H60.3675Z" fill="#FFC95B"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M31.8826 29.2496V62.9996H60.0075L31.8826 29.2496Z" fill="url(#paint1_linear_1_49380)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.75757 62.9997H31.8826V29.2497L3.75757 62.9997Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M60.3675 47.25V72H81L60.3675 47.25Z" fill="url(#paint2_linear_1_49380)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M39.7574 72H60.3674V47.25L39.7574 72Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M60.3675 40.4997C66.5807 40.4997 71.6175 35.4629 71.6175 29.2497C71.6175 23.0365 66.5807 17.9997 60.3675 17.9997C54.1543 17.9997 49.1175 23.0365 49.1175 29.2497C49.1175 35.4629 54.1543 40.4997 60.3675 40.4997Z" fill="#FFC95B"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M31.8824 22.4997C34.989 22.4997 37.5074 19.9813 37.5074 16.8747C37.5074 13.7681 34.989 11.2497 31.8824 11.2497C28.7758 11.2497 26.2574 13.7681 26.2574 16.8747C26.2574 19.9813 28.7758 22.4997 31.8824 22.4997Z" fill="#FFC95B"></path><defs><linearGradient id="paint0_linear_1_49380" x1="45" y1="-18.6396" x2="-18.6396" y2="45" gradientUnits="userSpaceOnUse"><stop stop-color="#FF2D55"></stop><stop offset="1" stop-color="#FFBC5B"></stop></linearGradient><linearGradient id="paint1_linear_1_49380" x1="31.8731" y1="29.2497" x2="31.8731" y2="62.9996" gradientUnits="userSpaceOnUse"><stop stop-color="#A524B3"></stop><stop offset="1" stop-color="#FF2D55"></stop></linearGradient><linearGradient id="paint2_linear_1_49380" x1="60.3605" y1="47.25" x2="60.3605" y2="72" gradientUnits="userSpaceOnUse"><stop stop-color="#A524B3"></stop><stop offset="1" stop-color="#FF2D55"></stop></linearGradient></defs></svg>
        <span>Decentraland (BEVY)</span>
    </h1>
    <form>
        <div class="input-group">
            <label for="realm">Initial Realm</label>
            <input type="text" id="realm" name="realm" placeholder="e.g., https://realm-provider-ea.decentraland.org/main">
        </div>

        <div class="input-group">
            <label for="position">Location</label>
            <input type="text" id="position" name="position" placeholder="e.g., 0,0">
        </div>

        <div class="input-group">
            <label for="systemScene">System Scene</label>
            <input type="text" id="systemScene" name="systemScene" placeholder="">
        </div>

        <div class="input-group">
            <label for="preview">Preview Mode <input type="checkbox" id="preview" name="preview"> </label>

        </div>

        <button type="button" id="initButton">Launch</button>
    </form>

    <div id="loading-container">
        <div class="loading-overall">
            <div class="loading-overall-bar">
                <div class="loading-overall-fill" id="loading-overall-fill"></div>
            </div>
        </div>
        <ul class="loading-steps">
            <li class="loading-step" data-step="download">
                    <span class="loading-step-icon">
                        <svg class="loading-step-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M8.76 15.24l-2.83 2.83m11.31 0l-2.83-2.83M8.76 8.76L5.93 5.93"/>
                        </svg>
                        <svg class="loading-step-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </span>
                <span class="loading-step-content">
                        <span class="loading-step-name">Downloading engine</span>
                        <div class="loading-step-bar"><div class="loading-step-fill" id="step-download-fill"></div></div>
                    </span>
            </li>
            <li class="loading-step" data-step="compile">
                    <span class="loading-step-icon">
                        <svg class="loading-step-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M8.76 15.24l-2.83 2.83m11.31 0l-2.83-2.83M8.76 8.76L5.93 5.93"/>
                        </svg>
                        <svg class="loading-step-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </span>
                <span class="loading-step-content">
                        <span class="loading-step-name">Compiling WASM</span>
                        <div class="loading-step-bar"><div class="loading-step-fill"></div></div>
                    </span>
            </li>
            <li class="loading-step" data-step="init">
                    <span class="loading-step-icon">
                        <svg class="loading-step-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M8.76 15.24l-2.83 2.83m11.31 0l-2.83-2.83M8.76 8.76L5.93 5.93"/>
                        </svg>
                        <svg class="loading-step-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </span>
                <span class="loading-step-content">
                        <span class="loading-step-name">Initializing engine</span>
                        <div class="loading-step-bar"><div class="loading-step-fill"></div></div>
                    </span>
            </li>
            <li class="loading-step" data-step="workers">
                    <span class="loading-step-icon">
                        <svg class="loading-step-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M8.76 15.24l-2.83 2.83m11.31 0l-2.83-2.83M8.76 8.76L5.93 5.93"/>
                        </svg>
                        <svg class="loading-step-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </span>
                <span class="loading-step-content">
                        <span class="loading-step-name">Starting workers</span>
                        <div class="loading-step-bar"><div class="loading-step-fill"></div></div>
                    </span>
            </li>
            <li class="loading-step" data-step="gpu">
                    <span class="loading-step-icon">
                        <svg class="loading-step-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M8.76 15.24l-2.83 2.83m11.31 0l-2.83-2.83M8.76 8.76L5.93 5.93"/>
                        </svg>
                        <svg class="loading-step-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </span>
                <span class="loading-step-content">
                        <span class="loading-step-name">Loading GPU cache</span>
                        <div class="loading-step-bar"><div class="loading-step-fill"></div></div>
                    </span>
            </li>
        </ul>
    </div>
</div>

<div id="loading-logo">
    <img src="logo.svg" alt="Logo">
</div>

<div id="canvas-parent">
    <canvas id="mygame-canvas"></canvas>
</div>
<div id="shader-compiling" style="position: absolute; height:30%; aspect-ratio: 1; background: radial-gradient(circle closest-side, #000000aa, #00000000); align-items: center; justify-content: center; display: none;">
    <image src="shader_compiling_transparent2.png" style="width: 100%;"/>
</div>
<script>
if (!window.__browserGateBlocked) {
    document.write('<script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js" crossorigin="anonymous"><\/script>');
    document.write('<script src="https://cdn.jsdelivr.net/npm/hls.js@1" crossorigin="anonymous"><\/script>');
    document.write('<script src="ui.js"><\/script>');
    document.write('<script type="module" src="main.js"><\/script>');
}
</script>
</body>
</html>
